# Match Management Architecture

## Data Structure Diagram

```
???????????????????????????????????????????????????????????????????
?                     FTC AutoConfig App                          ?
???????????????????????????????????????????????????????????????????
                              ?
???????????????????????????????????????????????????????????????????
?                    localStorage Storage                          ?
???????????????????????????????????????????????????????????????????
? Key: ftc-autoconfig-matches                                      ?
? Value: [                                                         ?
?   {                                                              ?
?     id: "uuid-1",                    ? Internal ID               ?
?     matchNumber: 1,                  ? Match property            ?
?     partnerTeam: "12345",            ? Match property            ?
?     alliance: "red",                 ? Match property            ?
?     startPosition: {                 ? Child node                ?
?       type: "front"                                              ?
?     },                                                           ?
?     actions: [                       ? Array of child nodes      ?
?       {                                                          ?
?         type: "near_launch",                                     ?
?         config: {}                                               ?
?       }                                                          ?
?     ]                                                            ?
?   },                                                             ?
?   { ... match 2 ... },                                          ?
?   { ... match 3 ... }                                           ?
? ]                                                                ?
???????????????????????????????????????????????????????????????????
                              ?
???????????????????????????????????????????????????????????????????
?                      Export Format                               ?
???????????????????????????????????????????????????????????????????
? {                                                                ?
?   "matches": [                       ? Top level array           ?
?     {                                                            ?
?       "matchNumber": 1,              ? Property                  ?
?       "partnerTeam": "12345",        ? Property                  ?
?       "alliance": "red",             ? Property                  ?
?       "startPosition": {             ? Child node                ?
?         "type": "front"                                          ?
?       },                                                         ?
?       "actions": [                   ? Child node array          ?
?         {                                                        ?
?           "type": "near_launch",                                 ?
?           "config": {}                                           ?
?         }                                                        ?
?       ]                                                          ?
?     }                                                            ?
?   ]                                                              ?
? }                                                                ?
???????????????????????????????????????????????????????????????????
```

## Component Hierarchy

```
App.jsx
??? Header
?   ??? Match Manager Button (with count badge)
?
??? HamburgerMenu
?   ??? Configure Actions
?   ??? Export JSON (all matches)
?   ??? Save as Template
?   ??? Load Template
?
??? WizardContainer
?   ??? Step1: Match Number      ??
?   ??? Step2: Partner Team       ?
?   ??? Step3: Alliance Color     ??? Edits currentMatch
?   ??? Step4: Start Position     ?
?   ??? Step5: Actions            ?
?   ??? Step6: QR Code            ??
?
??? WizardNavigation
?
??? Match Manager Modal
?   ??? MatchManager Component
?       ??? Add Match Button
?       ??? Match List
?           ??? Match Card (for each match)
?               ??? Select button
?               ??? Duplicate button
?               ??? Delete button
?
??? Manage Actions Modal
??? Save Template Modal
```

## Data Flow

### Adding a Match
```
User clicks "Add Match"
        ?
useMatches.addMatch()
        ?
New match object created
        ?
Added to matches array
        ?
Saved to localStorage
        ?
setCurrentMatchId(newMatchId)
        ?
UI updates to show new match
        ?
Wizard resets to Step 1
```

### Switching Matches
```
User clicks match in Match Manager
        ?
onSelectMatch(matchId)
        ?
setCurrentMatchId(matchId)
        ?
getCurrentMatch() returns new current match
        ?
Wizard updates to show selected match
        ?
All fields populate with match data
        ?
Match Manager closes
```

### Updating Match Data
```
User edits field in wizard
        ?
Field onChange handler
        ?
updateCurrentMatch({ field: value })
        ?
useMatches.updateMatch(currentMatchId, updates)
        ?
Match object updated in array
        ?
Saved to localStorage
        ?
UI re-renders with new data
```

### Exporting Configuration
```
User clicks Export
        ?
useMatches.exportAllMatches()
        ?
{
  matches: [
    { matchNumber, partnerTeam, alliance, startPosition, actions },
    { ... },
    { ... }
  ]
}
        ?
JSON.stringify()
        ?
Create Blob
        ?
Download or encode in QR code
```

## State Management

### Global State (App.jsx)
```javascript
// Wizard state
const [currentStep, setCurrentStep] = useState(0);
const [expandedGroup, setExpandedGroup] = useState(null);

// Modal state
const [showManageActions, setShowManageActions] = useState(false);
const [showSaveTemplate, setShowSaveTemplate] = useState(false);
const [showMatchManager, setShowMatchManager] = useState(false);

// Matches (from useMatches hook)
const {
  matches,              // Array of all matches
  currentMatchId,       // ID of match being edited
  addMatch,            // () => newMatchId
  deleteMatch,         // (matchId) => void
  updateMatch,         // (matchId, updates) => void
  getCurrentMatch,     // () => match object
  duplicateMatch,      // (matchId) => newMatchId
  exportAllMatches,    // () => { matches: [...] }
  setCurrentMatchId    // (matchId) => void
} = useMatches();
```

### Current Match Data
```javascript
const currentMatch = getCurrentMatch() || {
  matchNumber: 1,
  partnerTeam: '',
  alliance: 'red',
  startPosition: { type: 'front' },
  actions: []
};

// Accessed in wizard steps as:
// - currentMatch.matchNumber
// - currentMatch.partnerTeam
// - currentMatch.alliance
// - currentMatch.startPosition
// - currentMatch.actions
```

## UI Layouts

### Match Manager Modal
```
???????????????????????????????????????????????????
? Match Manager                          [X]      ?
???????????????????????????????????????????????????
?                                                 ?
?  Matches                     [+ Add Match]      ?
?                                                 ?
?  ????????????????????????????????????????????? ?
?  ? Match #1                          [RED]   ? ? ? Active
?  ? Partner: 12345 • 5 actions   [?] [??]    ? ?
?  ????????????????????????????????????????????? ?
?                                                 ?
?  ????????????????????????????????????????????? ?
?  ? Match #2                         [BLUE]   ? ?
?  ? Partner: 67890 • 3 actions   [?] [??]    ? ?
?  ????????????????????????????????????????????? ?
?                                                 ?
?  ????????????????????????????????????????????? ?
?  ? Match #3                          [RED]   ? ?
?  ? No partner set • 2 actions   [?] [??]    ? ?
?  ????????????????????????????????????????????? ?
?                                                 ?
???????????????????????????????????????????????????

Legend:
- [?] = Duplicate button
- [??] = Delete button
- Active match has highlighted border
```

### Header with Match Button
```
???????????????????????????????????????????????????
? [Matches (3)]    FTC AutoConfig          [?]   ?
?                  Match #1                       ?
???????????????????????????????????????????????????
```

## Storage Schema

### localStorage Keys
```
ftc-autoconfig-matches          ? Array of match objects
ftc-autoconfig-action-groups    ? Action definitions
ftc-autoconfig-start-positions  ? Start position presets
ftc-autoconfig-presets          ? Saved templates
```

### Match Object (in localStorage)
```javascript
{
  id: "550e8400-e29b-41d4-a716-446655440000",  // UUID v4
  matchNumber: 1,                               // Number
  partnerTeam: "12345",                        // String
  alliance: "red",                             // "red" | "blue"
  startPosition: {                             // Object
    type: "front",                             // String
    x: 0,                                      // Number (optional)
    y: 0,                                      // Number (optional)
    theta: 0                                   // Number (optional)
  },
  actions: [                                   // Array
    {
      id: "action-uuid",                       // UUID v4
      type: "near_launch",                     // String
      label: "Near Launch",                    // String
      config: {}                               // Object (optional)
    }
  ]
}
```

## API Reference

### useMatches Hook

```typescript
interface Match {
  id: string;
  matchNumber: number;
  partnerTeam: string;
  alliance: 'red' | 'blue';
  startPosition: {
    type: string;
    x?: number;
    y?: number;
    theta?: number;
  };
  actions: Action[];
}

interface UseMatchesReturn {
  matches: Match[];
  currentMatchId: string | null;
  setCurrentMatchId: (id: string | null) => void;
  addMatch: () => string;
  deleteMatch: (id: string) => void;
  updateMatch: (id: string, updates: Partial<Match>) => void;
  getCurrentMatch: () => Match | undefined;
  duplicateMatch: (id: string) => string | undefined;
  exportAllMatches: () => { matches: Omit<Match, 'id'>[] };
  importMatches: (config: { matches: Match[] }) => void;
}
```

### MatchManager Component

```typescript
interface MatchManagerProps {
  matches: Match[];
  currentMatchId: string | null;
  onSelectMatch: (id: string) => void;
  onAddMatch: () => void;
  onDeleteMatch: (id: string) => void;
  onDuplicateMatch: (id: string) => void;
}
```

## Migration Path

### From Single Match to Multi-Match

**Before:**
```javascript
const [matchNumber, setMatchNumber] = useState(1);
const [alliance, setAlliance] = useState('red');
const [actions, setActions] = useState([]);
// ... other fields
```

**After:**
```javascript
const matchesHook = useMatches();
const currentMatch = matchesHook.getCurrentMatch();

// Access via: currentMatch.matchNumber
// Update via: matchesHook.updateMatch(id, { matchNumber: 2 })
```

### Template Format Migration

**Old Format (Auto-detected):**
```json
{
  "matchNumber": 1,
  "alliance": "red",
  "actions": [...]
}
```

**New Format:**
```json
{
  "matches": [
    {
      "matchNumber": 1,
      "alliance": "red",
      "actions": [...]
    }
  ]
}
```

App automatically detects and handles both formats when loading templates.
